# Nginx Proxy с Автоматическим CI/CD

Автоматизированная система на базе Nginx для проксирования запросов на различные порты в зависимости от домена. 
Система полностью автоматизирована через GitHub Actions с настройкой через секреты репозитория.

## Возможности

* Автоматическая настройка проксирования доменов на разные порты
* Поддержка SSL через Let's Encrypt (опционально)
* Автоматический CI/CD через GitHub Actions
* Полная настройка через секреты репозитория без хардкода

## Быстрый старт

1. Склонируйте репозиторий
2. Настройте следующие секреты в репозитории GitHub:
   * `DOMAINS` - список доменов и портов (например: `replinet.ru:80,project.replinet.ru:8082` или в JSON формате `{"replinet.ru":80,"project.replinet.ru":8082}`)
   * `SERVER_IP` - IP-адрес вашего сервера
   * `SERVER_USER` - пользователь SSH на сервере (например, `root`)
   * `SSH_PRIVATE_KEY` - приватный SSH-ключ для доступа к серверу
   * `ENABLE_SSL` - включить SSL (`true` или `false`)
   * `EMAIL_FOR_SSL` - email для регистрации сертификатов Let's Encrypt (если SSL включен)
   * `NOTIFY_EMAIL` - email для уведомлений (опционально)
3. Сделайте пуш в ветку `main` или запустите workflow вручную

## Структура секретов

### DOMAINS

Формат: строка с перечислением пар "домен:порт" через запятую или строка в формате JSON.

**Примеры:**
```
replinet.ru:80,project.replinet.ru:8082
```

или

```json
{"replinet.ru":80,"project.replinet.ru":8082}
```

### ENABLE_SSL

Значение: `true` или `false`

Если установлено `true`, то будет автоматически запрошен SSL-сертификат через Let's Encrypt для каждого домена.

### Остальные секреты

* `SERVER_IP` - IP-адрес вашего сервера (например, `45.130.215.114`)
* `SERVER_USER` - пользователь SSH на сервере (например, `root`)
* `SSH_PRIVATE_KEY` - содержимое приватного SSH-ключа (начинается с `-----BEGIN OPENSSH PRIVATE KEY-----`)
* `EMAIL_FOR_SSL` - email для регистрации в Let's Encrypt (используется только если `ENABLE_SSL=true`)
* `NOTIFY_EMAIL` - email для уведомлений (опционально)

## Локальное тестирование

Для локального тестирования создайте файл `.env` и укажите необходимые переменные:

```
DOMAINS=replinet.ru:80,project.replinet.ru:8082
SERVER_IP=127.0.0.1
ENABLE_SSL=false
COMPOSE_PROJECT_NAME=nginx-proxy
```

Затем запустите:

```bash
docker-compose up -d
```

## Добавление новых доменов

Для добавления новых доменов просто обновите секрет `DOMAINS` в настройках репозитория и запустите workflow заново. 